<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <title>DPP-Battery Passport</title>

  <style>
    :root{
      --bg:#0a0f1b;
      --line: rgba(255,255,255,.10);
      --line2: rgba(120,160,255,.16);
      --text:#e9f0ff;
      --muted: rgba(233,240,255,.72);
      --muted2: rgba(233,240,255,.55);
      --blue:#67c7ff;
      --teal:#3fe0c1;
      --shadow: 0 22px 70px rgba(0,0,0,.55);
      --shadow2: 0 14px 44px rgba(0,0,0,.35);
      --r: 22px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f3f6ff;
        --line: rgba(17,24,39,.10);
        --line2: rgba(30,64,175,.14);
        --text:#0c1428;
        --muted: rgba(12,20,40,.70);
        --muted2: rgba(12,20,40,.55);
        --shadow: 0 26px 70px rgba(15, 23, 42, .16);
        --shadow2: 0 16px 44px rgba(15, 23, 42, .10);
      }
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1000px 600px at 15% -10%, rgba(103,199,255,.18), transparent 60%),
        radial-gradient(900px 560px at 100% 0%, rgba(63,224,193,.10), transparent 58%),
        var(--bg);
      overflow-x:hidden;
    }
    a{ color: var(--blue); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    .wrap{
      max-width: 1180px;
      margin: 0 auto;
      padding: 18px 12px 52px;
      padding-bottom: calc(52px + env(safe-area-inset-bottom, 0px));
    }

    .shell{
      border: 1px solid var(--line);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
    }
    .shell > *{ position: relative; }

    /* Header */
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 14px 14px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(0,0,0,.16), transparent);
      backdrop-filter: blur(10px);
    }
    .brand{ display:flex; align-items:center; gap: 10px; min-width: 220px; }
    .avatar{
      width: 30px; height: 30px; border-radius: 10px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .title{
      font-weight: 950;
      letter-spacing:.2px;
      margin:0;
      font-size: 16px;
      line-height: 1.2;
      white-space: nowrap;
    }

    .topright{ display:flex; align-items:center; gap: 10px; flex-wrap:wrap; justify-content:flex-end; }

    .btn{
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.05);
      color: var(--text);
      cursor:pointer;
      box-shadow: var(--shadow2);
      transition: transform .05s ease, border-color .15s ease, background .15s ease;
      font-size: 14px;
      display:inline-flex; align-items:center; gap: 8px;
      backdrop-filter: blur(10px);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      white-space: nowrap;
    }
    .btn:hover{ border-color: rgba(103,199,255,.38); background: rgba(255,255,255,.07); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(103,199,255,.55);
      background: rgba(103,199,255,.10);
    }

    .subline{
      padding: 10px 14px 0;
      color: var(--muted);
      font-size: 14px;
    }
    .content{ padding: 14px; }

    /* Cards */
    .grid2{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 12px;
      margin-top: 10px;
    }

    .card{
      border: 1px solid var(--line2);
      border-radius: var(--r);
      background: rgba(0,0,0,.10);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
      overflow: hidden;
    }
    .card .head{
      display:flex; align-items:center; gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      font-weight: 950;
      letter-spacing:.2px;
      font-size: 18px;
    }
    .card .body{
      padding: 12px 14px 14px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.55;
    }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .inlineLink{ display:flex; align-items:center; gap: 8px; flex-wrap:wrap; word-break: break-word; }
    .iconBtn{
      width: 28px; height: 28px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      display:inline-flex; align-items:center; justify-content:center;
      cursor:pointer;
      flex: 0 0 auto;
      -webkit-tap-highlight-color: transparent;
    }

    .kv{
      display:grid;
      grid-template-columns: 150px 1fr;
      gap: 8px 12px;
      align-items:start;
    }
    .k{ color: var(--muted2); }
    .v{ color: var(--text); word-break: break-word; }

    /* Tabs */
    .tabsShell{
      margin-top: 12px;
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(0,0,0,.10);
      box-shadow: var(--shadow2);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .tabs{
      display:flex;
      gap: 8px;
      align-items:center;
      padding: 10px 10px;
      border-bottom: 1px solid var(--line);
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      background: rgba(0,0,0,.06);
      position: sticky;
      top: 0;
      z-index: 5;
    }
    .tabs::-webkit-scrollbar{ display:none; }

    .tab{
      padding: 10px 12px;
      color: var(--muted2);
      font-size: 14px;
      cursor:pointer;
      border-radius: 12px;
      user-select:none;
      white-space: nowrap;
      flex: 0 0 auto;
      border: 1px solid transparent;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .tab.active{
      color: var(--blue);
      font-weight: 900;
      background: rgba(103,199,255,.10);
      border-color: rgba(103,199,255,.22);
    }

    .tabsBody{ padding: 14px; }

    .cols2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .miniCard{
      border: 1px solid var(--line2);
      border-radius: var(--r);
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow2);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .miniHead{
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      display:flex; align-items:center; gap: 10px;
      font-weight: 950;
      font-size: 16px;
    }
    .miniBody{
      padding: 12px 14px 14px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.55;
    }

    /* KPI strip */
    .kpis{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    .kpi{
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.04);
      padding: 10px 12px;
    }
    .kpi .t{ color: var(--muted2); font-size: 12px; font-weight: 800; }
    .kpi .n{ color: var(--text); font-size: 16px; font-weight: 950; margin-top: 4px; line-height: 1.2; }
    .kpi .s{ color: var(--muted); font-size: 12px; margin-top: 4px; }

    details{
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.03);
      padding: 10px 12px;
    }
    summary{
      cursor:pointer;
      color: var(--text);
      font-weight: 900;
      list-style:none;
    }
    summary::-webkit-details-marker{ display:none; }
    .detailList{
      margin: 10px 0 0;
      padding-left: 18px;
      color: var(--muted);
      line-height: 1.55;
    }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-size: 13px;
      font-weight: 800;
      width: fit-content;
    }
    .dot{ width:8px; height:8px; border-radius:999px; background: var(--blue); }

    /* SVG sizing: minimal & consistent */
    .i18 svg{ width:18px; height:18px; }
    .i16 svg{ width:16px; height:16px; }
    .i14 svg{ width:14px; height:14px; }
    svg{ opacity:.92; }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.75);
      color: #fff;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 13px;
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-6px);
    }

    @media (max-width: 920px){
      .grid2{ grid-template-columns: 1fr; }
      .cols2{ grid-template-columns: 1fr; }
    }
    @media (max-width: 600px){
      .header{ flex-direction: column; align-items: stretch; gap: 10px; }
      .title{ white-space: normal; }
      .topright{ width:100%; justify-content: stretch; }
      .btn{ width:100%; justify-content:center; }
      .kv{ grid-template-columns: 1fr; }
      .kpis{ grid-template-columns: 1fr; }
    }

    /* Clean mode (QR için) */
    .clean .header,
    .clean .subline { display:none !important; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">
      <div class="header">
        <div class="brand">
          <div class="avatar" aria-hidden="true"></div>
          <div class="title">DPP-Battery Passport</div>
        </div>

        <div class="topright">
          <button class="btn" id="copyLink">Link kopyala</button>
          <button class="btn primary" id="goAccess">Access</button>
        </div>
      </div>

      <div class="subline">QR kod ile batarya pasaportuna erişim.</div>

      <div class="content" id="app"></div>
    </div>
  </div>

  <div class="toast" id="toast">Kopyalandı</div>

<script>
  // --- Demo DB (teze uygun: CN vs EU örneği) ---
  const DB = {
    "urn:iso:15459:DPPBAT.CN.EV.2026.000001": {
      overview: {
        uid: "urn:iso:15459:DPPBAT.CN.EV.2026.000001",
        category: "EV traction battery",
        manufacturer: "Shenzhen PowerCell Ltd. (CN)",
        site: "Shenzhen, Guangdong (CN)",
        production: "December 2026"
      },
      safety: {
        hazardous: "Declared\nCobalt, Nickel as REACH ≥ 0.1%",
        extinguishing: "Water mist, Class D media, BC powder"
      },
      sustainability: {
        carbon: "58.0 kgCO₂e / kWh",
        class: "C",
        recycled: "Co 6% · Ni 5% · Li 2%",
        lifecycle: [
          { stage: "Raw materials", value: "32.0 kgCO₂e/kWh" },
          { stage: "Cell manufacturing", value: "18.5 kgCO₂e/kWh" },
          { stage: "Pack assembly", value: "4.0 kgCO₂e/kWh" },
          { stage: "Transport", value: "3.5 kgCO₂e/kWh" }
        ],
        method: "Methodology reference"
      },
      circularity: {
        takeback: "National collection / take-back guidance (placeholder)."
      },
      documents: [
        { title: "EU Declaration of Conformity (placeholder)", url: "https://example.com/eu-doc" },
        { title: "Carbon footprint study (placeholder)", url: "https://example.com/pcf" }
      ],
      professional: {
        dismantling: "HV isolation + PPE required. Disassembly sequence available under restricted access."
      },
      authority: {
        reports: ["Test Report ID: TR-CN-EV-2026-EMC-01"],
        soh: "SoH 98.4% · cycles 62"
      }
    },

    "urn:iso:15459:DPPBAT.EU.EV.2026.000001": {
      overview: {
        uid: "urn:iso:15459:DPPBAT.EU.EV.2026.000001",
        category: "EV traction battery",
        manufacturer: "EuroCell Energy S.A. (EU)",
        site: "Wroclaw (PL)",
        production: "December 2026"
      },
      safety: {
        hazardous: "Declared\nNickel as REACH ≥ 0.1%",
        extinguishing: "Water mist, Class D media, BC powder"
      },
      sustainability: {
        carbon: "41.5 kgCO₂e / kWh",
        class: "B",
        recycled: "Co 10% · Ni 8% · Li 4%",
        lifecycle: [
          { stage: "Raw materials", value: "22.0 kgCO₂e/kWh" },
          { stage: "Cell manufacturing", value: "14.0 kgCO₂e/kWh" },
          { stage: "Pack assembly", value: "3.0 kgCO₂e/kWh" },
          { stage: "Transport", value: "2.5 kgCO₂e/kWh" }
        ],
        method: "Methodology reference"
      },
      circularity: {
        takeback: "National collection / take-back guidance (placeholder)."
      },
      documents: [
        { title: "EU Declaration of Conformity (placeholder)", url: "https://example.com/eu-doc" },
        { title: "Carbon footprint study (placeholder)", url: "https://example.com/pcf" }
      ],
      professional: {
        dismantling: "HV isolation + thermal-runaway precautions. Disassembly sequence available under restricted access."
      },
      authority: {
        reports: ["Test Report ID: TR-EU-EV-2026-EMC-01"],
        soh: "SoH 99.1% · cycles 58"
      }
    }
  };

  // --- URL params ---
  const qs = new URLSearchParams(location.search);
  const uid = qs.get("uid") || Object.keys(DB)[0];
  const role = (qs.get("role") || "public").toLowerCase(); // public|professional|authority
  const tab  = (qs.get("tab")  || "details").toLowerCase(); // details|sustainability|circularity|documents|access

  if(qs.get("mode")==="clean") document.body.classList.add("clean");

  function baseUrl(){ return location.origin + location.pathname; }
  function linkFor(next = {}){
    const p = new URLSearchParams(location.search);
    for(const [k,v] of Object.entries(next)){
      if(v === null) p.delete(k);
      else p.set(k, v);
    }
    return `${baseUrl()}?${p.toString()}`;
  }
  function esc(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }

  // --- Toast ---
  const toast = document.getElementById("toast");
  let toastTimer = null;
  function showToast(msg="Kopyalandı"){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=> toast.classList.remove("show"), 1400);
  }
  async function copy(text){
    try{ await navigator.clipboard.writeText(text); showToast("Kopyalandı"); }
    catch{ prompt("Kopyalamak için:", text); }
  }

  // --- Icons (minimal, professional) ---
  const S = `fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"`;
  const ICONS = {
    doc: `<span class="i18"><svg viewBox="0 0 24 24" ${S}>
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
      <path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/>
    </svg></span>`,
    shield:`<span class="i18"><svg viewBox="0 0 24 24" ${S}>
      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
      <path d="M9 12l2 2 4-4"/>
    </svg></span>`,
    info:`<span class="i14"><svg viewBox="0 0 24 24" ${S}>
      <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
    </svg></span>`,
    leaf:`<span class="i14"><svg viewBox="0 0 24 24" ${S}>
      <path d="M11 20c6 0 10-4 10-10V4s-6 0-10 4-4 10-4 10 1 2 4 2z"/>
      <path d="M21 4L11 14"/>
    </svg></span>`,
    recycle:`<span class="i14"><svg viewBox="0 0 24 24" ${S}>
      <path d="M7 19l-2-3 3-2"/><path d="M3 16h6"/>
      <path d="M7 5l2 3-3 2"/><path d="M9 8H3"/>
      <path d="M17 19l-2 3-3-2"/><path d="M21 16h-6"/>
      <path d="M17 5l2-3 3 2"/><path d="M15 8h6"/>
    </svg></span>`,
    file:`<span class="i14"><svg viewBox="0 0 24 24" ${S}>
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
      <path d="M14 2v6h6"/>
    </svg></span>`,
    key:`<span class="i14"><svg viewBox="0 0 24 24" ${S}>
      <path d="M21 2l-2 2"/><path d="M11.5 11.5a4.5 4.5 0 1 1 6.36 6.36L14 22l-4-4 1.5-1.5 2 2L16 16l-2-2 1.5-1.5 2 2 1.36-1.36"/>
    </svg></span>`,
    clip:`<span class="i16"><svg viewBox="0 0 24 24" ${S}>
      <path d="M21.44 11.05l-9.19 9.19a5 5 0 0 1-7.07-7.07l9.9-9.9a3.5 3.5 0 0 1 4.95 4.95l-10.6 10.6a2 2 0 1 1-2.83-2.83l9.9-9.9"/>
    </svg></span>`
  };

  const app = document.getElementById("app");
  const data = DB[uid];

  function tabBtn(name, key, icon){
    return `<div class="tab ${tab===key?'active':''}" data-tab="${key}">${icon}<span>${name}</span></div>`;
  }

  function viewChip(){
    const label = role === "authority" ? "Authority" : (role === "professional" ? "Professional" : "Public");
    return `<span class="chip"><span class="dot"></span>${label}</span>`;
  }

  function renderNotFound(){
    app.innerHTML = `
      <div class="card">
        <div class="head">${ICONS.doc} DPP-Battery Passport</div>
        <div class="body">UID için kayıt bulunamadı: <span class="mono">${esc(uid)}</span></div>
      </div>
    `;
  }

  function showTabBody(tabBody){
    const d = data;

    if(tab === "details"){
      tabBody.innerHTML = `
        <div class="cols2">
          <div class="miniCard">
            <div class="miniHead">${ICONS.info} Details</div>
            <div class="miniBody">
              ${viewChip()}
              <div style="height:10px"></div>
              <div class="kv">
                <div class="k">Shareable link</div>
                <div class="v"><a href="${esc(linkFor({uid, role, tab:"details"}))}">${esc(linkFor({uid, role, tab:"details"}))}</a></div>
              </div>
            </div>
          </div>

          <div class="miniCard">
            <div class="miniHead">${ICONS.doc} Passport</div>
            <div class="miniBody">
              <div class="kv">
                <div class="k">UID</div>
                <div class="v"><span class="mono">${esc(d.overview.uid)}</span></div>
                <div class="k">Select</div>
                <div class="v">
                  <select id="pick" style="width:100%; padding:12px 12px; border-radius:14px; border:1px solid var(--line); background:rgba(255,255,255,.04); color:var(--text); font-size:14px;">
                    ${Object.keys(DB).map(k=>`<option value="${k}" ${k===uid?'selected':''}>${k.includes(".CN.")?"China (CN)":"EU (EU)"} — ${k}</option>`).join("")}
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      document.getElementById("pick").addEventListener("change",(e)=>{
        location.href = linkFor({ uid: e.target.value, tab:"details" });
      });
      return;
    }

    if(tab === "sustainability"){
      const carbon = d.sustainability?.carbon || "N/A";
      const cls = d.sustainability?.class || "N/A";
      const rec = d.sustainability?.recycled || "N/A";
      const lifecycle = Array.isArray(d.sustainability?.lifecycle) ? d.sustainability.lifecycle : [];

      tabBody.innerHTML = `
        <div class="miniCard">
          <div class="miniHead">${ICONS.leaf} Sustainability</div>
          <div class="miniBody">
            ${viewChip()}
            <div style="height:10px"></div>

            <div class="kpis">
              <div class="kpi">
                <div class="t">Carbon footprint</div>
                <div class="n" style="color:var(--blue)">${esc(carbon)}</div>
                <div class="s">kgCO₂e / kWh</div>
              </div>
              <div class="kpi">
                <div class="t">Performance class</div>
                <div class="n">${esc(cls)}</div>
                <div class="s">Declared</div>
              </div>
              <div class="kpi">
                <div class="t">Recycled content</div>
                <div class="n">${esc(rec)}</div>
                <div class="s">Declared</div>
              </div>
            </div>

            <details ${lifecycle.length ? "" : "style='opacity:.85'"} >
              <summary>Lifecycle breakdown</summary>
              ${
                lifecycle.length
                  ? `<ul class="detailList">
                      ${lifecycle.map(x=>`<li><b>${esc(x.stage)}:</b> ${esc(x.value)}</li>`).join("")}
                    </ul>`
                  : `<div style="margin-top:10px; color:var(--muted);">No breakdown provided.</div>`
              }
              <div style="margin-top:10px; color:var(--muted2); font-size:12px;">
                Method: ${esc(d.sustainability?.method || "N/A")}
              </div>
            </details>

          </div>
        </div>
      `;
      return;
    }

    if(tab === "circularity"){
      tabBody.innerHTML = `
        <div class="miniCard">
          <div class="miniHead">${ICONS.recycle} Circularity</div>
          <div class="miniBody">
            <div class="kv">
              <div class="k">Collection / take-back</div>
              <div class="v">${esc(d.circularity?.takeback || "N/A")}</div>
            </div>
          </div>
        </div>
      `;
      return;
    }

    if(tab === "documents"){
      const list = (d.documents||[]).map(x=>`<li><a href="${esc(x.url)}" target="_blank" rel="noopener">${esc(x.title)}</a></li>`).join("");
      tabBody.innerHTML = `
        <div class="miniCard">
          <div class="miniHead">${ICONS.file} Documents</div>
          <div class="miniBody">
            <ul style="margin:0; padding-left:18px;">${list || "<li>No public documents</li>"}</ul>
          </div>
        </div>
      `;
      return;
    }

    // Access
    const restricted = (role !== "professional" && role !== "authority");
    tabBody.innerHTML = `
      <div class="miniCard">
        <div class="miniHead">${ICONS.key} Access</div>
        <div class="miniBody">
          ${viewChip()}
          <div style="height:12px"></div>

          <div class="kv">
            <div class="k">Professional</div>
            <div class="v">${restricted ? "Restricted" : esc(d.professional?.dismantling || "N/A")}</div>

            <div class="k">Authority</div>
            <div class="v">${role==="authority"
              ? `${esc((d.authority?.reports||[]).join(" · "))}<br/>${esc(d.authority?.soh || "")}`
              : "Restricted"}</div>
          </div>

          <div style="height:12px"></div>

          <button class="btn primary" id="goPro2" style="width:100%; justify-content:center;">Open Professional view</button>
          <div style="height:10px"></div>
          <button class="btn" id="goAuth2" style="width:100%; justify-content:center;">Open Authority view</button>
        </div>
      </div>
    `;
    document.getElementById("goPro2").onclick  = ()=> location.href = linkFor({ role:"professional", tab:"access" });
    document.getElementById("goAuth2").onclick = ()=> location.href = linkFor({ role:"authority", tab:"access" });
  }

  function render(){
    if(!data){ renderNotFound(); return; }

    // Overview + Safety (Public ilk ekran)
    const overview = `
      <div class="card">
        <div class="head">${ICONS.doc} DPP-Battery Passport</div>
        <div class="body">
          <div class="kv">
            <div class="k">UID</div>
            <div class="v inlineLink">
              <span class="mono">${esc(data.overview.uid)}</span>
              <span class="iconBtn" id="copyUid" title="Copy UID">${ICONS.clip}</span>
            </div>

            <div class="k">Type</div>
            <div class="v">${esc(data.overview.category)}</div>

            <div class="k">Manufacturer</div>
            <div class="v">${esc(data.overview.manufacturer)}</div>

            <div class="k">Site</div>
            <div class="v">${esc(data.overview.site)}</div>

            <div class="k">Production date</div>
            <div class="v">${esc(data.overview.production)}</div>
          </div>
        </div>
      </div>
    `;

    const safety = `
      <div class="card">
        <div class="head">${ICONS.shield} Safety</div>
        <div class="body">
          <div style="color:var(--muted2); font-weight:900; margin-bottom:6px;">Hazardous substances</div>
          <div style="white-space:pre-line;">${esc(data.safety.hazardous)}</div>

          <div style="height:12px"></div>

          <div style="color:var(--muted2); font-weight:900; margin-bottom:6px;">Extinguishing agent</div>
          <div style="color:var(--teal); font-weight:900;">${esc(data.safety.extinguishing)}</div>
        </div>
      </div>
    `;

    const tabs = `
      <div class="tabsShell">
        <div class="tabs" id="tabs">
          ${tabBtn("Details","details", ICONS.info)}
          ${tabBtn("Sustainability","sustainability", ICONS.leaf)}
          ${tabBtn("Circularity","circularity", ICONS.recycle)}
          ${tabBtn("Documents","documents", ICONS.file)}
          ${tabBtn("Access","access", ICONS.key)}
        </div>
        <div class="tabsBody" id="tabBody"></div>
      </div>
    `;

    app.innerHTML = `<div class="grid2">${overview}${safety}</div>${tabs}`;

    document.getElementById("tabs").addEventListener("click",(e)=>{
      const t = e.target.closest(".tab");
      if(!t) return;
      location.href = linkFor({ tab: t.dataset.tab });
    });

    document.getElementById("copyUid").onclick = ()=> copy(data.overview.uid);
    showTabBody(document.getElementById("tabBody"));
  }

  render();

  // Header buttons
  document.getElementById("copyLink").onclick = ()=> copy(location.href);
  document.getElementById("goAccess").onclick = ()=> location.href = linkFor({ tab:"access", role: (role==="public" ? "professional" : role) });
</script>
</body>
</html>

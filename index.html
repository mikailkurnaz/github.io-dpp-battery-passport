<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <title>DPP Battery Passport ‚Äì Viewer</title>

  <style>
    :root{
      --bg:#0a0f1b;
      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.04);
      --line: rgba(255,255,255,.10);
      --line2: rgba(120,160,255,.16);
      --text:#e9f0ff;
      --muted: rgba(233,240,255,.72);
      --muted2: rgba(233,240,255,.55);
      --blue:#67c7ff;
      --teal:#3fe0c1;
      --shadow: 0 22px 70px rgba(0,0,0,.55);
      --shadow2: 0 14px 44px rgba(0,0,0,.35);
      --r: 22px;
      --r2: 16px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f3f6ff;
        --glass: rgba(17,24,39,.04);
        --glass2: rgba(17,24,39,.03);
        --line: rgba(17,24,39,.10);
        --line2: rgba(30,64,175,.14);
        --text:#0c1428;
        --muted: rgba(12,20,40,.70);
        --muted2: rgba(12,20,40,.55);
        --shadow: 0 26px 70px rgba(15, 23, 42, .16);
        --shadow2: 0 16px 44px rgba(15, 23, 42, .10);
      }
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1000px 600px at 15% -10%, rgba(103,199,255,.22), transparent 60%),
        radial-gradient(900px 560px at 100% 0%, rgba(63,224,193,.14), transparent 58%),
        radial-gradient(900px 600px at 10% 110%, rgba(103,199,255,.10), transparent 58%),
        var(--bg);
      overflow-x:hidden;
    }
    a{ color: var(--blue); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    .wrap{
      max-width: 1180px;
      margin: 0 auto;
      padding: 20px 14px 52px;
      padding-bottom: calc(52px + env(safe-area-inset-bottom, 0px));
    }

    .shell{
      border: 1px solid var(--line);
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03) 35%, rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
    }
    .shell::before{
      content:"";
      position:absolute; inset:-1px;
      background: radial-gradient(900px 360px at 20% 0%, rgba(103,199,255,.18), transparent 60%),
                  radial-gradient(600px 320px at 90% 10%, rgba(63,224,193,.14), transparent 55%);
      pointer-events:none;
      opacity:.9;
    }
    .shell > *{ position: relative; }

    /* Header */
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 16px 16px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(0,0,0,.18), transparent);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap: 12px;
      min-width: 220px;
    }
    .avatar{
      width: 34px; height: 34px; border-radius: 12px;
      border: 1px solid var(--line);
      background: conic-gradient(from 45deg, rgba(255,255,255,.12), rgba(255,255,255,.02), rgba(255,255,255,.12));
      position: relative;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .avatar::after{
      content:"";
      position:absolute; inset:0;
      background-image:
        linear-gradient(90deg, rgba(255,255,255,.18) 0 50%, rgba(255,255,255,.03) 50% 100%),
        linear-gradient(0deg, rgba(255,255,255,.18) 0 50%, rgba(255,255,255,.03) 50% 100%);
      background-size: 10px 10px;
      opacity:.55;
      mix-blend-mode: overlay;
    }

    .title{
      font-weight: 800;
      letter-spacing:.2px;
      margin:0;
      font-size: clamp(15px, 2.2vw, 18px);
      line-height: 1.2;
      white-space: nowrap;
    }

    .topright{
      display:flex; align-items:center; gap: 10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.05);
      color: var(--text);
      cursor:pointer;
      box-shadow: var(--shadow2);
      transition: transform .05s ease, border-color .15s ease, background .15s ease;
      font-size: 14px;
      display:inline-flex; align-items:center; gap: 8px;
      backdrop-filter: blur(10px);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      white-space: nowrap;
    }
    .btn:hover{ border-color: rgba(103,199,255,.40); background: rgba(255,255,255,.07); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(103,199,255,.55);
      background: rgba(103,199,255,.12);
    }

    .subline{
      padding: 12px 16px 0;
      color: var(--muted);
      font-size: clamp(14px, 2vw, 16px);
    }
    .subline b{ color: var(--blue); font-weight: 800; }

    .content{ padding: 14px 16px 16px; }

    /* Cards */
    .grid2{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
      margin-top: 12px;
    }

    .card{
      border: 1px solid var(--line2);
      border-radius: var(--r);
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03) 45%, rgba(255,255,255,.02)),
        rgba(0,0,0,.10);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
      overflow: hidden;
    }
    .card .head{
      display:flex; align-items:center; gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      font-weight: 900;
      letter-spacing:.2px;
      font-size: clamp(16px, 2.6vw, 22px);
    }
    .card .body{
      padding: 12px 14px 14px;
      color: var(--muted);
      font-size: clamp(14px, 2vw, 16px);
      line-height: 1.45;
    }

    /* Overview layout */
    .overviewWrap{
      display:grid;
      grid-template-columns: 92px 1fr;
      gap: 14px;
      align-items:center;
    }
    .bigIcon{
      width: 92px; height: 92px;
      border-radius: 18px;
      border: 1px solid var(--line);
      background: rgba(103,199,255,.08);
      display:flex; align-items:center; justify-content:center;
    }
    .list{ display:flex; flex-direction:column; gap: 10px; }
    .item{ display:flex; align-items:flex-start; gap: 10px; color: var(--muted); }
    .item b{ color: var(--text); font-weight: 800; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .inlineLink{ display:flex; align-items:center; gap: 8px; flex-wrap:wrap; word-break: break-word; }
    .iconBtn{
      width: 28px; height: 28px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      display:inline-flex; align-items:center; justify-content:center;
      cursor:pointer;
      flex: 0 0 auto;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    /* Tabs bar (mobile-friendly) */
    .tabsShell{
      margin-top: 14px;
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(0,0,0,.12);
      box-shadow: var(--shadow2);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .tabs{
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 10px 10px;
      border-bottom: 1px solid var(--line);
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .tabs::-webkit-scrollbar{ display:none; }

    .tab{
      padding: 12px 16px;
      color: var(--muted2);
      font-size: clamp(14px, 2.2vw, 18px);
      cursor:pointer;
      border-radius: 12px;
      user-select:none;
      white-space: nowrap;
      flex: 0 0 auto;
    }
    .tab.active{
      color: var(--blue);
      font-weight: 900;
      background: rgba(103,199,255,.10);
      border: 1px solid rgba(103,199,255,.22);
    }

    .tabsBody{ padding: 14px 14px 16px; }

    .cols2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    .miniCard{
      border: 1px solid var(--line2);
      border-radius: var(--r);
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow2);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .miniHead{
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      display:flex; align-items:center; gap: 10px;
      font-weight: 900;
      font-size: clamp(16px, 2.6vw, 22px);
    }
    .miniBody{
      padding: 12px 14px 14px;
      color: var(--muted);
      font-size: clamp(14px, 2vw, 16px);
      line-height: 1.45;
    }

    .kv{
      display:grid;
      grid-template-columns: 200px 1fr;
      gap: 10px 14px;
      align-items:start;
    }
    .k{ color: var(--muted2); }
    .v{ color: var(--text); word-break: break-word; }

    .hint{
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted2);
    }

    /* === MOBILE BREAKPOINTS === */
    @media (max-width: 920px){
      .grid2{ grid-template-columns: 1fr; }
      .cols2{ grid-template-columns: 1fr; }
    }
    @media (max-width: 600px){
      .wrap{ padding: 14px 10px 44px; }
      .header{
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      .brand{ min-width: 0; }
      .title{ white-space: normal; }

      .topright{
        width:100%;
        justify-content: stretch;
      }
      .btn{
        width:100%;
        justify-content:center;
        padding: 12px 14px; /* bigger touch */
      }

      .content{ padding: 12px 12px 14px; }
      .subline{ padding: 10px 12px 0; }

      .overviewWrap{
        grid-template-columns: 1fr;
      }
      .bigIcon{
        width: 78px; height: 78px;
      }
      .kv{ grid-template-columns: 1fr; }
      .tabsShell{ border-radius: 18px; }
      .tabs{ position: sticky; top: 0; z-index: 5; background: rgba(0,0,0,.18); }
    }

    /* Clean mode for thesis screenshots */
    .clean .header,
    .clean .subline { display:none !important; }

    @media print{
      body{ background:#fff !important; }
      .shell{ box-shadow:none !important; }
      .header, .subline{ display:none !important; }
    }

    /* SVG sizing */
    .svg{ width: 26px; height: 26px; opacity: .95; }
    .svgSmall{ width: 18px; height: 18px; opacity: .95; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">
      <div class="header">
        <div class="brand">
          <div class="avatar" aria-hidden="true"></div>
          <div class="title">DPP Battery Passport ‚Äì Viewer</div>
        </div>

        <div class="topright">
          <button class="btn" id="copyLink">Link kopyala</button>
          <button class="btn primary" id="goProfessional">Professional Access</button>
        </div>
      </div>

      <div class="subline">
        QR ile eri≈üilen pasaport i√ßeriƒüi, <b>Public / Professional / Authority</b> g√∂r√ºn√ºmleriyle g√∂sterilir.
      </div>

      <div class="content" id="app"></div>
    </div>
  </div>

<script>
  // ---------------------------------------------------------
  // DEMO DATA (senin iki senaryon)
  // ---------------------------------------------------------
  const DB = {
    "urn:iso:15459:DPPBAT.CN.EV.2026.000001": {
      overview: {
        uid: "urn:iso:15459:DPPBAT.CN.EV.2026.000001",
        category: "EV traction battery",
        manufacturer: "Shenzhen PowerCell Ltd. (CN)",
        site: "Shenzhen, Guangdong (CN)",
        production: "December 2026"
      },
      safety: {
        hazardous: "Declared (demo)\nCobalt, Nickel as REACH ‚â• 0.1%",
        extinguishing: "Water mist, D, BC powder"
      },
      sustainability: {
        carbon: "58.0 kgCO‚ÇÇe / kWh",
        method: "Methodology: (demo placeholder)",
        recycled: "Cobalt: 6 %, Ni 5 %, Li 2 %",
        recycled_note: "Production reference (demo)"
      },
      sourcing: {
        dd: "Due diligence / sourcing report (demo)",
        epr: "National collection guidelines (demo)"
      },
      documents: [
        { title: "EU Declaration of Conformity (demo)", url: "https://example.com/eu-doc-demo" },
        { title: "Carbon footprint study (demo)", url: "https://example.com/pcf-demo" }
      ],
      professional: {
        note: "Bu alanlar ger√ßek hayatta yetkilendirme ile a√ßƒ±lƒ±r (demo).",
        dismantling: "HV isolation + PPE required. Disassembly sequence (demo)."
      },
      authority: {
        note: "Yetkili kurum/NB g√∂r√ºn√ºm√º (demo).",
        reports: ["TR-CN-EV-2026-EMC-01 (demo)"],
        soh: "SoH 98.4%, cycles 62"
      }
    },

    "urn:iso:15459:DPPBAT.EU.EV.2026.000001": {
      overview: {
        uid: "urn:iso:15459:DPPBAT.EU.EV.2026.000001",
        category: "EV traction battery",
        manufacturer: "EuroCell Energy S.A. (EU)",
        site: "Wroclaw (PL)",
        production: "December 2026"
      },
      safety: {
        hazardous: "Declared (demo)\nNickel as REACH ‚â• 0.1%",
        extinguishing: "Water mist, D, BC powder"
      },
      sustainability: {
        carbon: "41.5 kgCO‚ÇÇe / kWh",
        method: "Methodology: (demo placeholder)",
        recycled: "Cobalt: 10 %, Ni 8 %, Li 4 %",
        recycled_note: "Production reference (demo)"
      },
      sourcing: {
        dd: "Due diligence / sourcing report (demo)",
        epr: "National collection guidelines (demo)"
      },
      documents: [
        { title: "EU Declaration of Conformity (demo)", url: "https://example.com/eu-doc-demo" },
        { title: "Carbon footprint study (demo)", url: "https://example.com/pcf-demo" }
      ],
      professional: {
        note: "Bu alanlar ger√ßek hayatta yetkilendirme ile a√ßƒ±lƒ±r (demo).",
        dismantling: "HV isolation + thermal-runaway precautions (demo)."
      },
      authority: {
        note: "Yetkili kurum/NB g√∂r√ºn√ºm√º (demo).",
        reports: ["TR-EU-EV-2026-EMC-01 (demo)"],
        soh: "SoH 99.1%, cycles 58"
      }
    }
  };

  // ---------------------------------------------------------
  // URL params
  // ---------------------------------------------------------
  const qs = new URLSearchParams(location.search);
  const uid = qs.get("uid") || Object.keys(DB)[0];
  const role = (qs.get("role") || "public").toLowerCase(); // public|professional|authority
  const tab  = (qs.get("tab")  || "details").toLowerCase(); // details|sustainability|circularity|documents|professional

  if(qs.get("mode")==="clean") document.body.classList.add("clean");

  function baseUrl(){ return location.origin + location.pathname; }
  function linkFor(next = {}){
    const p = new URLSearchParams(location.search);
    for(const [k,v] of Object.entries(next)){
      if(v === null) p.delete(k);
      else p.set(k, v);
    }
    return `${baseUrl()}?${p.toString()}`;
  }
  async function copy(text){
    try{ await navigator.clipboard.writeText(text); alert("Kopyalandƒ±"); }
    catch{ prompt("Kopyalamak i√ßin:", text); }
  }
  function esc(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }

  // SVG icons
  const ICONS = {
    doc: `<svg class="svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
      <path d="M14 2v6h6"/>
      <path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/>
    </svg>`,
    shield:`<svg class="svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
      <path d="M9 12l2 2 4-4"/>
    </svg>`,
    battery:`<svg class="svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="2" y="7" width="18" height="10" rx="2"/>
      <path d="M22 11v2"/>
      <path d="M6 10h8"/><path d="M6 14h6"/>
    </svg>`,
    clip: `<svg class="svgSmall" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21.44 11.05l-9.19 9.19a5 5 0 0 1-7.07-7.07l9.9-9.9a3.5 3.5 0 0 1 4.95 4.95l-10.6 10.6a2 2 0 1 1-2.83-2.83l9.9-9.9"/>
    </svg>`,
    leaf:`<svg class="svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M11 20c6 0 10-4 10-10V4s-6 0-10 4-4 10-4 10 1 2 4 2z"/>
      <path d="M21 4L11 14"/>
    </svg>`,
    recycle:`<svg class="svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M7 19l-2-3 3-2"/><path d="M3 16h6"/><path d="M7 5l2 3-3 2"/><path d="M9 8H3"/>
      <path d="M17 19l-2 3-3-2"/><path d="M21 16h-6"/><path d="M17 5l2-3 3 2"/><path d="M15 8h6"/>
    </svg>`,
    user:`<svg class="svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20 21a8 8 0 0 0-16 0"/><circle cx="12" cy="7" r="4"/>
    </svg>`
  };

  const app = document.getElementById("app");
  const data = DB[uid];

  function tabBtn(name, key){
    return `<div class="tab ${tab===key?'active':''}" data-tab="${key}">${name}</div>`;
  }

  function renderNotFound(){
    app.innerHTML = `
      <div class="card">
        <div class="head">${ICONS.doc} Passport Not Found</div>
        <div class="body">Bu UID i√ßin kayƒ±t yok: <span class="mono">${esc(uid)}</span></div>
      </div>
    `;
  }

  function showTabBody(tabBody){
    const d = data;

    if(tab === "details"){
      tabBody.innerHTML = `
        <div class="cols2">
          <div class="miniCard">
            <div class="miniHead">${ICONS.battery} Details</div>
            <div class="miniBody">
              <div class="kv">
                <div class="k">Current role</div>
                <div class="v"><b>${esc(role.toUpperCase())}</b></div>
                <div class="k">Shareable link</div>
                <div class="v"><a href="${esc(linkFor({uid, role, tab:"details"}))}">${esc(linkFor({uid, role, tab:"details"}))}</a></div>
              </div>
              <div class="hint">Telefon ekranƒ±nda sekmeler yatay kaydƒ±rƒ±labilir.</div>
            </div>
          </div>

          <div class="miniCard">
            <div class="miniHead">${ICONS.user} Demo se√ßim</div>
            <div class="miniBody">
              <div class="kv">
                <div class="k">Kayƒ±t</div>
                <div class="v">
                  <select id="pick" style="width:100%; padding:12px 12px; border-radius:14px; border:1px solid var(--line); background:rgba(255,255,255,.04); color:var(--text); font-size:14px;">
                    ${Object.keys(DB).map(k=>`<option value="${k}" ${k===uid?'selected':''}>${k.includes(".CN.")?"China (CN)":"EU (EU)"} ‚Äî ${k}</option>`).join("")}
                  </select>
                </div>
              </div>
              <div class="hint">J√ºri QR ile farklƒ± UID‚Äôlere ge√ßebilir.</div>
            </div>
          </div>
        </div>
      `;
      document.getElementById("pick").addEventListener("change",(e)=>{
        location.href = linkFor({ uid: e.target.value, tab:"details" });
      });
      return;
    }

    if(tab === "sustainability"){
      tabBody.innerHTML = `
        <div class="cols2">
          <div class="miniCard">
            <div class="miniHead">${ICONS.leaf} Sustainability Snapshot</div>
            <div class="miniBody">
              <div style="font-weight:900; color:var(--text)">Battery carbon footprint</div>
              <div style="margin-top:8px;"><b style="color:var(--blue)">${esc(d.sustainability.carbon)}</b></div>
              <div class="hint">${esc(d.sustainability.method)}</div>

              <div style="height:14px"></div>

              <div style="font-weight:900; color:var(--text)">Recycled content</div>
              <div style="margin-top:8px;">${esc(d.sustainability.recycled)}</div>
              <div class="hint">${esc(d.sustainability.recycled_note)}</div>
            </div>
          </div>

          <div class="miniCard">
            <div class="miniHead">${ICONS.recycle} Responsible Sourcing</div>
            <div class="miniBody">
              <div class="kv">
                <div class="k">Due diligence</div>
                <div class="v">${esc(d.sourcing.dd)}</div>
                <div class="k">EPR / Collection</div>
                <div class="v">${esc(d.sourcing.epr)}</div>
              </div>
            </div>
          </div>
        </div>
      `;
      return;
    }

    if(tab === "circularity"){
      tabBody.innerHTML = `
        <div class="miniCard">
          <div class="miniHead">${ICONS.recycle} Circularity</div>
          <div class="miniBody">
            <div class="kv">
              <div class="k">Collection / Take-back</div>
              <div class="v">Ulusal toplama sistemi ve geri d√∂n√º≈ü√ºm y√∂nlendirmesi (demo).</div>
              <div class="k">Disassembly</div>
              <div class="v">Detay s√∂k√ºm talimatlarƒ± <b>Professional</b> eri≈üim ile a√ßƒ±lƒ±r.</div>
              <div class="k">Second-life</div>
              <div class="v">SoH verileri yetkili rollerde g√∂sterilir (demo).</div>
            </div>
          </div>
        </div>
      `;
      return;
    }

    if(tab === "documents"){
      const list = (d.documents||[]).map(x=>`<li><a href="${esc(x.url)}" target="_blank" rel="noopener">${esc(x.title)}</a></li>`).join("");
      tabBody.innerHTML = `
        <div class="miniCard">
          <div class="miniHead">${ICONS.doc} Documents</div>
          <div class="miniBody">
            <ul style="margin:0; padding-left:18px;">${list || "<li>No documents (demo)</li>"}</ul>
          </div>
        </div>
      `;
      return;
    }

    // professional tab
    const locked = (role !== "professional" && role !== "authority");
    tabBody.innerHTML = `
      <div class="miniCard">
        <div class="miniHead">${ICONS.user} Professional Access</div>
        <div class="miniBody">
          <div class="kv">
            <div class="k">Access status</div>
            <div class="v"><b>${locked ? "Locked (demo)" : "Enabled (demo)"}</b></div>
            <div class="k">Note</div>
            <div class="v">${esc(d.professional.note)}</div>
            <div class="k">Dismantling</div>
            <div class="v">${locked ? "üîí Yetkilendirme gerekir (demo)." : esc(d.professional.dismantling)}</div>
            <div class="k">Authority info</div>
            <div class="v">${role==="authority" ? `${esc(d.authority.note)}<br/>Reports: ${esc(d.authority.reports.join(", "))}<br/>${esc(d.authority.soh)}` : "‚Äî"}</div>
          </div>

          <div style="height:12px"></div>

          <button class="btn primary" id="unlockPro" style="width:100%; justify-content:center;">Professional role‚Äôa ge√ß (demo)</button>
          <div style="height:10px"></div>
          <button class="btn" id="unlockAuth" style="width:100%; justify-content:center;">Authority role‚Äôa ge√ß (demo)</button>
        </div>
      </div>
    `;
    document.getElementById("unlockPro").onclick  = ()=> location.href = linkFor({ role:"professional", tab:"professional" });
    document.getElementById("unlockAuth").onclick = ()=> location.href = linkFor({ role:"authority", tab:"professional" });
  }

  function render(){
    if(!data){ renderNotFound(); return; }

    const overview = `
      <div class="card">
        <div class="head">${ICONS.doc} Battery Passport Overview</div>
        <div class="body">
          <div class="overviewWrap">
            <div class="bigIcon" aria-hidden="true">${ICONS.battery}</div>
            <div class="list">
              <div class="item">
                <span class="k">UID:</span>
                <span class="v inlineLink">
                  <b class="mono">${esc(data.overview.uid)}</b>
                  <span class="iconBtn" id="copyUid" title="UID kopyala">${ICONS.clip}</span>
                </span>
              </div>
              <div class="item"><span class="k">üåê</span><span class="v">${esc(data.overview.category)}</span></div>
              <div class="item"><span class="k">üè¢</span><span class="v">${esc(data.overview.manufacturer)}</span></div>
              <div class="item"><span class="k">üè≠</span><span class="v">Manufacturing site: ${esc(data.overview.site)}</span></div>
              <div class="item"><span class="k">üóìÔ∏è</span><span class="v">Production date: ${esc(data.overview.production)}</span></div>
            </div>
          </div>
        </div>
      </div>
    `;

    const safety = `
      <div class="card">
        <div class="head">${ICONS.shield} Safety Snapshot</div>
        <div class="body">
          <div style="font-weight:900; color:var(--text); margin-bottom:6px;">Hazardous substances</div>
          <div style="white-space:pre-line;">${esc(data.safety.hazardous)}</div>
          <div style="height:12px"></div>
          <div style="font-weight:900; color:var(--text); margin-bottom:6px;">Extinguishing agent</div>
          <div style="color:var(--teal); font-weight:800;">‚ôª ${esc(data.safety.extinguishing)}</div>
        </div>
      </div>
    `;

    const tabs = `
      <div class="tabsShell">
        <div class="tabs" id="tabs">
          ${tabBtn("Details","details")}
          ${tabBtn("Sustainability","sustainability")}
          ${tabBtn("Circularity","circularity")}
          ${tabBtn("Documents","documents")}
          ${tabBtn("Professional Access","professional")}
        </div>
        <div class="tabsBody" id="tabBody"></div>
      </div>
    `;

    app.innerHTML = `
      <div class="grid2">${overview}${safety}</div>
      ${tabs}
    `;

    // events
    document.getElementById("tabs").addEventListener("click",(e)=>{
      const t = e.target.closest(".tab");
      if(!t) return;
      location.href = linkFor({ tab: t.dataset.tab });
    });

    document.getElementById("copyUid").onclick = ()=> copy(data.overview.uid);

    // render tab body
    showTabBody(document.getElementById("tabBody"));
  }

  render();

  // header buttons
  document.getElementById("copyLink").onclick = ()=> copy(location.href);
  document.getElementById("goProfessional").onclick = ()=> location.href = linkFor({ tab:"professional", role:"professional" });
</script>
</body>
</html>
